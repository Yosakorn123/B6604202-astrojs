---
export const prerender = false;

import Layout from '../../layouts/Layout.astro';
import HeaderNav from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

let pokemon = null;
let error = null;

try {
  const { id } = Astro.params;
  const API_URL = `https://pokeapi.co/api/v2/pokemon/${id}`;
  const response = await fetch(API_URL);

  if (!response.ok) {
    throw new Error(`Unable to fetch Pokémon with ID: ${id}`);
  }

  pokemon = await response.json();
} catch (err) {
  error = err.message;
}

export async function getStaticPaths() {
  // ดึง 10 Pokémon ID แรก
  const response = await fetch('https://pokeapi.co/api/v2/pokemon?limit=30');
  const data = await response.json();

  return data.results.map((pokemon, index) => ({
    params: { id: (index + 1).toString() },
  }));
}
---

<Layout>
  <HeaderNav />

  <section class="pokemon-details" style="text-align: center;">
    {error ? (
      <div class="error-message">
        <h1>Error</h1>
        <p>{error}</p>
        <a href="/">Back to Pokémon List</a>
      </div>
    ) : (
      <div>
        <header>
          <h1>{pokemon.name}</h1>
        </header>
        <div class="details">
          <figure>
            <img src={pokemon.sprites.front_default} alt={pokemon.name} />
          </figure>
          <figure>
            <img src={pokemon.sprites.other.dream_world.front_default} alt={`${pokemon.name} Dream World`} />
          </figure>
          <div><strong>Weight:</strong> {pokemon.weight}</div>
          <div><strong>Height:</strong> {pokemon.height}</div>
        </div>
        <footer>
          <a href="/" class="button">Back to Pokémon List</a>
          
        </footer>
      </div>
    )}
  </section>


  <Footer />
</Layout>

<style>
    .button {
        background-color: #199319;
        color: white;
        padding: 15px 25px;
        text-decoration: none;
    }

    .button:hover {
    background-color: #223094;
    }
</style>
